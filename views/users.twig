{% extends "html.twig" %}
{% set title = "users" %}

{% block content %}
{% import "./_macros.twig" as utils %}
<div class="d-flex flex-column gap-1">
<div class="d-flex flex-row flex-wrap ai-center gap-3">
  <h2>{{ t.users.users }}</h2>
  <div class="d-flex flex-row flex-wrap gap-2 ms-auto w-autoto100-sm">
  {% include '/components/pagination.twig' with {params: req.query, page: page, queries: items, totalpages: pages, classes: "jc-center"} %}
  <div class="d-flex flex-row pillify flex-grow-1">
  <input name="q" class="w-100" placeholder="search for a game.." value="{{ req.query.q }}" onkeydown="search_onkeyup(this)" id="game-search" type="search">
  <button class="mx-1" onclick="search_onkeyup($('#game-search'), true)"><h5 class="bi bi-search"></h5></button>
  </div>
  <div class="pos-relative">
    <button onclick="dropdownify(this, $('#filterresults'));"><h4 class="bi bi-filter"></h4></button>
    <div class="pos-absolute dropdownify mt-1 card d-flex flex-column gap-3" style="width: 14em; z-index: 2;" id="filterresults">
      <div class="d-flex flex-row gap-3"><h5>filter</h5>
      </div>
      <hr class="mt-1 mb-1">
      {% include '/components/query_btns.twig' with {urlparams: req.query, keyparam: "order", valueparam: "ASC", text: t.filter.order_by_ascending} %}
      {% include '/components/query_btns.twig' with {urlparams: req.query, keyparam: "order", valueparam: "DESC", text: t.filter.order_by_descending} %}
      <hr class="mt-1 mb-1">
      {% include '/components/query_btns.twig' with {urlparams: req.query, keyparam: "sort", valueparam: "random", text: "sort by " ~ "<b>random</b>"} %}
      {% for name, column in sorts %}
      {% include '/components/query_btns.twig' with {urlparams: req.query, keyparam: "sort", valueparam: column, text: "sort by " ~ "<b>" ~ name ~ "</b>"} %}
      {% endfor %}
    </div>
  </div>
  </div>
</div>
<hr class="mt-3 mb-2">
{% if items|length == 0 %}
  <div class="d-flex flex-column ai-center gap-2 p-3">
  <h1 style="font-size: 4em;" class="bi bi-egg-fried"></h1>
  <h4>no users found</h4>
  <small class="text-muted">heres a fried egg for you</small>
  </div>
{% else %}
  <div class="d-flex flex-column gap-3" style="grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));">
    {% set allow_hr = false %}
    {% for user in items %}
      {%- if allow_hr ?? false %}<hr class="mt-1 mb-1">{% endif -%}
        <a href="/users/{{ user.id }}/profile" class="d-flex flex-row flex-wrap gap-4 ai-center">
          <div class="pos-relative">
          <img class="round-4" height=84 width=84 src="{{ user.get_headshot() }}">
          {% if user.is_online %}<i class="pos-absolute icon-online bottom-0 right-0" style="transform: translate(25%, 25%);"></i>{% endif %}
          </div>
          <div class="d-flex flex-column gap-2">
          <b>{{ user.username }}</b>
          <small class="text-muted">{{ user.status }}</small>
          </div>
          <small class="text-muted ms-auto">{% if user.is_online %}online{% else %}{{ user.online|timeago }}{% endif %}</small>
        </a>
      {% set allow_hr = true %}
    {% endfor -%}
  </div>
{% endif -%}
</div>
{% endblock %}